'use strict';

var _component = require('./../common/component.js');

(0, _component.VantComponent)({
  classes: ['active-class', 'toolbar-class', 'column-class'],
  props: {
    title: String,
    value: String,
    loading: Boolean,
    cancelButtonText: String,
    confirmButtonText: String,
    itemHeight: {
      type: Number,
      value: 44
    },
    visibleItemCount: {
      type: Number,
      value: 5
    },
    columnsNum: {
      type: [String, Number],
      value: 3
    },
    areaList: {
      type: Object,
      value: {}
    }
  },
  data: {
    columns: [{
      values: []
    }, {
      values: []
    }, {
      values: []
    }],
    displayColumns: [{
      values: []
    }, {
      values: []
    }, {
      values: []
    }]
  },
  watch: {
    value: function value(_value) {
      this.code = _value;
      this.setValues();
    },
    areaList: 'setValues',
    columnsNum: function columnsNum(value) {
      this.set({
        displayColumns: this.data.columns.slice(0, +value)
      });
    }
  },
  methods: {
    getPicker: function getPicker() {
      if (this.picker == null) {
        this.picker = this.selectComponent('.van-area__picker');
      }

      return this.picker;
    },
    onCancel: function onCancel(event) {
      this.emit('cancel', event.detail);
    },
    onConfirm: function onConfirm(event) {
      this.emit('confirm', event.detail);
    },
    emit: function emit(type, detail) {
      detail.values = detail.value;
      delete detail.value;
      this.$emit(type, detail);
    },
    onChange: function onChange(event) {
      var _this = this;

      var _event$detail = event.detail,
          index = _event$detail.index,
          picker = _event$detail.picker,
          value = _event$detail.value;
      this.code = value[index].code;
      this.setValues().then(function () {
        _this.$emit('change', {
          picker: picker,
          values: picker.getValues(),
          index: index
        });
      });
    },
    getConfig: function getConfig(type) {
      var areaList = this.data.areaList;
      return areaList && areaList[type + "_list"] || {};
    },
    getList: function getList(type, code) {
      var result = [];

      if (type !== 'province' && !code) {
        return result;
      }

      var list = this.getConfig(type);
      result = Object.keys(list).map(function (code) {
        return {
          code: code,
          name: list[code]
        };
      });

      if (code) {
        // oversea code
        if (code[0] === '9' && type === 'city') {
          code = '9';
        }

        result = result.filter(function (item) {
          return item.code.indexOf(code) === 0;
        });
      }

      return result;
    },
    getIndex: function getIndex(type, code) {
      var compareNum = type === 'province' ? 2 : type === 'city' ? 4 : 6;
      var list = this.getList(type, code.slice(0, compareNum - 2)); // oversea code

      if (code[0] === '9' && type === 'province') {
        compareNum = 1;
      }

      code = code.slice(0, compareNum);

      for (var i = 0; i < list.length; i++) {
        if (list[i].code.slice(0, compareNum) === code) {
          return i;
        }
      }

      return 0;
    },
    setValues: function setValues() {
      var county = this.getConfig('county');
      var code = this.code || Object.keys(county)[0] || '';
      var province = this.getList('province');
      var city = this.getList('city', code.slice(0, 2));
      var picker = this.getPicker();

      if (!picker) {
        return;
      }

      var stack = [];
      stack.push(picker.setColumnValues(0, province, false));
      stack.push(picker.setColumnValues(1, city, false));

      if (city.length && code.slice(2, 4) === '00') {
        ;
        code = city[0].code;
      }

      stack.push(picker.setColumnValues(2, this.getList('county', code.slice(0, 4)), false));
      stack.push(picker.setIndexes([this.getIndex('province', code), this.getIndex('city', code), this.getIndex('county', code)]));
      return Promise.all(stack).catch(function () {});
    },
    getValues: function getValues() {
      var picker = this.getPicker();
      return picker ? picker.getValues().filter(function (value) {
        return !!value;
      }) : [];
    },
    getDetail: function getDetail() {
      var values = this.getValues();
      var area = {
        code: '',
        country: '',
        province: '',
        city: '',
        county: ''
      };

      if (!values.length) {
        return area;
      }

      var names = values.map(function (item) {
        return item.name;
      });
      area.code = values[values.length - 1].code;

      if (area.code[0] === '9') {
        area.country = names[1] || '';
        area.province = names[2] || '';
      } else {
        area.province = names[0] || '';
        area.city = names[1] || '';
        area.county = names[2] || '';
      }

      return area;
    },
    reset: function reset() {
      this.code = '';
      return this.setValues();
    }
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImNsYXNzZXMiLCJwcm9wcyIsInRpdGxlIiwiU3RyaW5nIiwidmFsdWUiLCJsb2FkaW5nIiwiQm9vbGVhbiIsImNhbmNlbEJ1dHRvblRleHQiLCJjb25maXJtQnV0dG9uVGV4dCIsIml0ZW1IZWlnaHQiLCJ0eXBlIiwiTnVtYmVyIiwidmlzaWJsZUl0ZW1Db3VudCIsImNvbHVtbnNOdW0iLCJhcmVhTGlzdCIsIk9iamVjdCIsImRhdGEiLCJjb2x1bW5zIiwidmFsdWVzIiwiZGlzcGxheUNvbHVtbnMiLCJ3YXRjaCIsIl92YWx1ZSIsImNvZGUiLCJzZXRWYWx1ZXMiLCJzZXQiLCJzbGljZSIsIm1ldGhvZHMiLCJnZXRQaWNrZXIiLCJwaWNrZXIiLCJzZWxlY3RDb21wb25lbnQiLCJvbkNhbmNlbCIsImV2ZW50IiwiZW1pdCIsImRldGFpbCIsIm9uQ29uZmlybSIsIiRlbWl0Iiwib25DaGFuZ2UiLCJfdGhpcyIsIl9ldmVudCRkZXRhaWwiLCJpbmRleCIsInRoZW4iLCJnZXRWYWx1ZXMiLCJnZXRDb25maWciLCJnZXRMaXN0IiwicmVzdWx0IiwibGlzdCIsImtleXMiLCJtYXAiLCJuYW1lIiwiZmlsdGVyIiwiaXRlbSIsImluZGV4T2YiLCJnZXRJbmRleCIsImNvbXBhcmVOdW0iLCJpIiwibGVuZ3RoIiwiY291bnR5IiwicHJvdmluY2UiLCJjaXR5Iiwic3RhY2siLCJwdXNoIiwic2V0Q29sdW1uVmFsdWVzIiwic2V0SW5kZXhlcyIsIlByb21pc2UiLCJhbGwiLCJjYXRjaCIsImdldERldGFpbCIsImFyZWEiLCJjb3VudHJ5IiwibmFtZXMiLCJyZXNldCJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7QUFDQSw4QkFBYztBQUNaQSxXQUFTLENBQUMsY0FBRCxFQUFpQixlQUFqQixFQUFrQyxjQUFsQyxDQURHO0FBRVpDLFNBQU87QUFDTEMsV0FBT0MsTUFERjtBQUVMQyxXQUFPRCxNQUZGO0FBR0xFLGFBQVNDLE9BSEo7QUFJTEMs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O0FBTEMsT0FBWDs7QUFRQSxVQUFJLENBQUN0QyxPQUFPcUMsTUFBWixFQUFvQjtBQUNsQixlQUFPWSxJQUFQO0FBQ0Q7O0FBRUQsVUFBSUUsUUFBUW5ELE9BQU82QixHQUFQLENBQVcsVUFBVUcsSUFBVixFQUFnQjtBQUNyQyxlQUFPQSxLQUFLRixJQUFaO0FBQ0QsT0FGVyxDQUFaO0FBR0FtQixXQUFLN0MsSUFBTCxHQUFZSixPQUFPQSxPQUFPcUMsTUFBUCxHQUFnQixDQUF2QixFQUEwQmpDLElBQXRDOztBQUVBLFVBQUk2QyxLQUFLN0MsSUFBTCxDQUFVLENBQVYsTUFBaUIsR0FBckIsRUFBMEI7QUFDeEI2QyxhQUFLQyxPQUFMLEdBQWVDLE1BQU0sQ0FBTixLQUFZLEVBQTNCO0FBQ0FGLGFBQUtWLFFBQUwsR0FBZ0JZLE1BQU0sQ0FBTixLQUFZLEVBQTVCO0FBQ0QsT0FIRCxNQUdPO0FBQ0xGLGFBQUtWLFFBQUwsR0FBZ0JZLE1BQU0sQ0FBTixLQUFZLEVBQTVCO0FBQ0FGLGFBQUtULElBQUwsR0FBWVcsTUFBTSxDQUFOLEtBQVksRUFBeEI7QUFDQUYsYUFBS1gsTUFBTCxHQUFjYSxNQUFNLENBQU4sS0FBWSxFQUExQjtBQUNEOztBQUVELGFBQU9GLElBQVA7QUFDRCxLQWhKTTtBQWlKUEcsV0FBTyxTQUFTQSxLQUFULEdBQWlCO0FBQ3RCLFdBQUtoRCxJQUFMLEdBQVksRUFBWjtBQUNBLGFBQU8sS0FBS0MsU0FBTCxFQUFQO0FBQ0Q7QUFwSk07QUFyREcsQ0FBZCIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFZhbnRDb21wb25lbnQgfSBmcm9tICcuLi9jb21tb24vY29tcG9uZW50JztcblZhbnRDb21wb25lbnQoe1xuICBjbGFzc2VzOiBbJ2FjdGl2ZS1jbGFzcycsICd0b29sYmFyLWNsYXNzJywgJ2NvbHVtbi1jbGFzcyddLFxuICBwcm9wczoge1xuICAgIHRpdGxlOiBTdHJpbmcsXG4gICAgdmFsdWU6IFN0cmluZyxcbiAgICBsb2FkaW5nOiBCb29sZWFuLFxuICAgIGNhbmNlbEJ1dHRvblRleHQ6IFN0cmluZyxcbiAgICBjb25maXJtQnV0dG9uVGV4dDogU3RyaW5nLFxuICAgIGl0ZW1IZWlnaHQ6IHtcbiAgICAgIHR5cGU6IE51bWJlcixcbiAgICAgIHZhbHVlOiA0NFxuICAgIH0sXG4gICAgdmlzaWJsZUl0ZW1Db3VudDoge1xuICAgICAgdHlwZTogTnVtYmVyLFxuICAgICAgdmFsdWU6IDVcbiAgICB9LFxuICAgIGNvbHVtbnNOdW06IHtcbiAgICAgIHR5cGU6IFtTdHJpbmcsIE51bWJlcl0sXG4gICAgICB2YWx1ZTogM1xuICAgIH0sXG4gICAgYXJlYUxpc3Q6IHtcbiAgICAgIHR5cGU6IE9iamVjdCxcbiAgICAgIHZhbHVlOiB7fVxuICAgIH1cbiAgfSxcbiAgZGF0YToge1xuICAgIGNvbHVtbnM6IFt7XG4gICAgICB2YWx1ZXM6IFtdXG4gICAgfSwge1xuICAgICAgdmFsdWVzOiBbXVxuICAgIH0sIHtcbiAgICAgIHZhbHVlczogW11cbiAgICB9XSxcbiAgICBkaXNwbGF5Q29sdW1uczogW3tcbiAgICAgIHZhbHVlczogW11cbiAgICB9LCB7XG4gICAgICB2YWx1ZXM6IFtdXG4gICAgfSwge1xuICAgICAgdmFsdWVzOiBbXVxuICAgIH1dXG4gIH0sXG4gIHdhdGNoOiB7XG4gICAgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKF92YWx1ZSkge1xuICAgICAgdGhpcy5jb2RlID0gX3ZhbHVlO1xuICAgICAgdGhpcy5zZXRWYWx1ZXMoKTtcbiAgICB9LFxuICAgIGFyZWFMaXN0OiAnc2V0VmFsdWVzJyxcbiAgICBjb2x1bW5zTnVtOiBmdW5jdGlvbiBjb2x1bW5zTnVtKHZhbHVlKSB7XG4gICAgICB0aGlzLnNldCh7XG4gICAgICAgIGRpc3BsYXlDb2x1bW5zOiB0aGlzLmRhdGEuY29sdW1ucy5zbGljZSgwLCArdmFsdWUpXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4gIG1ldGhvZHM6IHtcbiAgICBnZXRQaWNrZXI6IGZ1bmN0aW9uIGdldFBpY2tlcigpIHtcbiAgICAgIGlmICh0aGlzLnBpY2tlciA9PSBudWxsKSB7XG4gICAgICAgIHRoaXMucGlja2VyID0gdGhpcy5zZWxlY3RDb21wb25lbnQoJy52YW4tYXJlYV9fcGlja2VyJyk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLnBpY2tlcjtcbiAgICB9LFxuICAgIG9uQ2FuY2VsOiBmdW5jdGlvbiBvbkNhbmNlbChldmVudCkge1xuICAgICAgdGhpcy5lbWl0KCdjYW5jZWwnLCBldmVudC5kZXRhaWwpO1xuICAgIH0sXG4gICAgb25Db25maXJtOiBmdW5jdGlvbiBvbkNvbmZpcm0oZXZlbnQpIHtcbiAgICAgIHRoaXMuZW1pdCgnY29uZmlybScsIGV2ZW50LmRldGFpbCk7XG4gICAgfSxcbiAgICBlbWl0OiBmdW5jdGlvbiBlbWl0KHR5cGUsIGRldGFpbCkge1xuICAgICAgZGV0YWlsLnZhbHVlcyA9IGRldGFpbC52YWx1ZTtcbiAgICAgIGRlbGV0ZSBkZXRhaWwudmFsdWU7XG4gICAgICB0aGlzLiRlbWl0KHR5cGUsIGRldGFpbCk7XG4gICAgfSxcbiAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UoZXZlbnQpIHtcbiAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG5cbiAgICAgIHZhciBfZXZlbnQkZGV0YWlsID0gZXZlbnQuZGV0YWlsLFxuICAgICAgICAgIGluZGV4ID0gX2V2ZW50JGRldGFpbC5pbmRleCxcbiAgICAgICAgICBwaWNrZXIgPSBfZXZlbnQkZGV0YWlsLnBpY2tlcixcbiAgICAgICAgICB2YWx1ZSA9IF9ldmVudCRkZXRhaWwudmFsdWU7XG4gICAgICB0aGlzLmNvZGUgPSB2YWx1ZVtpbmRleF0uY29kZTtcbiAgICAgIHRoaXMuc2V0VmFsdWVzKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIF90aGlzLiRlbWl0KCdjaGFuZ2UnLCB7XG4gICAgICAgICAgcGlja2VyOiBwaWNrZXIsXG4gICAgICAgICAgdmFsdWVzOiBwaWNrZXIuZ2V0VmFsdWVzKCksXG4gICAgICAgICAgaW5kZXg6IGluZGV4XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBnZXRDb25maWc6IGZ1bmN0aW9uIGdldENvbmZpZyh0eXBlKSB7XG4gICAgICB2YXIgYXJlYUxpc3QgPSB0aGlzLmRhdGEuYXJlYUxpc3Q7XG4gICAgICByZXR1cm4gYXJlYUxpc3QgJiYgYXJlYUxpc3RbdHlwZSArIFwiX2xpc3RcIl0gfHwge307XG4gICAgfSxcbiAgICBnZXRMaXN0OiBmdW5jdGlvbiBnZXRMaXN0KHR5cGUsIGNvZGUpIHtcbiAgICAgIHZhciByZXN1bHQgPSBbXTtcblxuICAgICAgaWYgKHR5cGUgIT09ICdwcm92aW5jZScgJiYgIWNvZGUpIHtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cblxuICAgICAgdmFyIGxpc3QgPSB0aGlzLmdldENvbmZpZyh0eXBlKTtcbiAgICAgIHJlc3VsdCA9IE9iamVjdC5rZXlzKGxpc3QpLm1hcChmdW5jdGlvbiAoY29kZSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGNvZGU6IGNvZGUsXG4gICAgICAgICAgbmFtZTogbGlzdFtjb2RlXVxuICAgICAgICB9O1xuICAgICAgfSk7XG5cbiAgICAgIGlmIChjb2RlKSB7XG4gICAgICAgIC8vIG92ZXJzZWEgY29kZVxuICAgICAgICBpZiAoY29kZVswXSA9PT0gJzknICYmIHR5cGUgPT09ICdjaXR5Jykge1xuICAgICAgICAgIGNvZGUgPSAnOSc7XG4gICAgICAgIH1cblxuICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgcmV0dXJuIGl0ZW0uY29kZS5pbmRleE9mKGNvZGUpID09PSAwO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9LFxuICAgIGdldEluZGV4OiBmdW5jdGlvbiBnZXRJbmRleCh0eXBlLCBjb2RlKSB7XG4gICAgICB2YXIgY29tcGFyZU51bSA9IHR5cGUgPT09ICdwcm92aW5jZScgPyAyIDogdHlwZSA9PT0gJ2NpdHknID8gNCA6IDY7XG4gICAgICB2YXIgbGlzdCA9IHRoaXMuZ2V0TGlzdCh0eXBlLCBjb2RlLnNsaWNlKDAsIGNvbXBhcmVOdW0gLSAyKSk7IC8vIG92ZXJzZWEgY29kZVxuXG4gICAgICBpZiAoY29kZVswXSA9PT0gJzknICYmIHR5cGUgPT09ICdwcm92aW5jZScpIHtcbiAgICAgICAgY29tcGFyZU51bSA9IDE7XG4gICAgICB9XG5cbiAgICAgIGNvZGUgPSBjb2RlLnNsaWNlKDAsIGNvbXBhcmVOdW0pO1xuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGxpc3RbaV0uY29kZS5zbGljZSgwLCBjb21wYXJlTnVtKSA9PT0gY29kZSkge1xuICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAwO1xuICAgIH0sXG4gICAgc2V0VmFsdWVzOiBmdW5jdGlvbiBzZXRWYWx1ZXMoKSB7XG4gICAgICB2YXIgY291bnR5ID0gdGhpcy5nZXRDb25maWcoJ2NvdW50eScpO1xuICAgICAgdmFyIGNvZGUgPSB0aGlzLmNvZGUgfHwgT2JqZWN0LmtleXMoY291bnR5KVswXSB8fCAnJztcbiAgICAgIHZhciBwcm92aW5jZSA9IHRoaXMuZ2V0TGlzdCgncHJvdmluY2UnKTtcbiAgICAgIHZhciBjaXR5ID0gdGhpcy5nZXRMaXN0KCdjaXR5JywgY29kZS5zbGljZSgwLCAyKSk7XG4gICAgICB2YXIgcGlja2VyID0gdGhpcy5nZXRQaWNrZXIoKTtcblxuICAgICAgaWYgKCFwaWNrZXIpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB2YXIgc3RhY2sgPSBbXTtcbiAgICAgIHN0YWNrLnB1c2gocGlja2VyLnNldENvbHVtblZhbHVlcygwLCBwcm92aW5jZSwgZmFsc2UpKTtcbiAgICAgIHN0YWNrLnB1c2gocGlja2VyLnNldENvbHVtblZhbHVlcygxLCBjaXR5LCBmYWxzZSkpO1xuXG4gICAgICBpZiAoY2l0eS5sZW5ndGggJiYgY29kZS5zbGljZSgyLCA0KSA9PT0gJzAwJykge1xuICAgICAgICA7XG4gICAgICAgIGNvZGUgPSBjaXR5WzBdLmNvZGU7XG4gICAgICB9XG5cbiAgICAgIHN0YWNrLnB1c2gocGlja2VyLnNldENvbHVtblZhbHVlcygyLCB0aGlzLmdldExpc3QoJ2NvdW50eScsIGNvZGUuc2xpY2UoMCwgNCkpLCBmYWxzZSkpO1xuICAgICAgc3RhY2sucHVzaChwaWNrZXIuc2V0SW5kZXhlcyhbdGhpcy5nZXRJbmRleCgncHJvdmluY2UnLCBjb2RlKSwgdGhpcy5nZXRJbmRleCgnY2l0eScsIGNvZGUpLCB0aGlzLmdldEluZGV4KCdjb3VudHknLCBjb2RlKV0pKTtcbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChzdGFjaykuY2F0Y2goZnVuY3Rpb24gKCkge30pO1xuICAgIH0sXG4gICAgZ2V0VmFsdWVzOiBmdW5jdGlvbiBnZXRWYWx1ZXMoKSB7XG4gICAgICB2YXIgcGlja2VyID0gdGhpcy5nZXRQaWNrZXIoKTtcbiAgICAgIHJldHVybiBwaWNrZXIgPyBwaWNrZXIuZ2V0VmFsdWVzKCkuZmlsdGVyKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gISF2YWx1ZTtcbiAgICAgIH0pIDogW107XG4gICAgfSxcbiAgICBnZXREZXRhaWw6IGZ1bmN0aW9uIGdldERldGFpbCgpIHtcbiAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLmdldFZhbHVlcygpO1xuICAgICAgdmFyIGFyZWEgPSB7XG4gICAgICAgIGNvZGU6ICcnLFxuICAgICAgICBjb3VudHJ5OiAnJyxcbiAgICAgICAgcHJvdmluY2U6ICcnLFxuICAgICAgICBjaXR5OiAnJyxcbiAgICAgICAgY291bnR5OiAnJ1xuICAgICAgfTtcblxuICAgICAgaWYgKCF2YWx1ZXMubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBhcmVhO1xuICAgICAgfVxuXG4gICAgICB2YXIgbmFtZXMgPSB2YWx1ZXMubWFwKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgIHJldHVybiBpdGVtLm5hbWU7XG4gICAgICB9KTtcbiAgICAgIGFyZWEuY29kZSA9IHZhbHVlc1t2YWx1ZXMubGVuZ3RoIC0gMV0uY29kZTtcblxuICAgICAgaWYgKGFyZWEuY29kZVswXSA9PT0gJzknKSB7XG4gICAgICAgIGFyZWEuY291bnRyeSA9IG5hbWVzWzFdIHx8ICcnO1xuICAgICAgICBhcmVhLnByb3ZpbmNlID0gbmFtZXNbMl0gfHwgJyc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhcmVhLnByb3ZpbmNlID0gbmFtZXNbMF0gfHwgJyc7XG4gICAgICAgIGFyZWEuY2l0eSA9IG5hbWVzWzFdIHx8ICcnO1xuICAgICAgICBhcmVhLmNvdW50eSA9IG5hbWVzWzJdIHx8ICcnO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gYXJlYTtcbiAgICB9LFxuICAgIHJlc2V0OiBmdW5jdGlvbiByZXNldCgpIHtcbiAgICAgIHRoaXMuY29kZSA9ICcnO1xuICAgICAgcmV0dXJuIHRoaXMuc2V0VmFsdWVzKCk7XG4gICAgfVxuICB9XG59KTsiXX0=